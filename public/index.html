<html>

<head>

<title>Okta + Arkose Labs</title>

<!-- javascript -->

<!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- okta sign-in widget -->
<script src="https://s3.us-east-2.amazonaws.com/tom-smith-okta/okta-widget/okta-sign-in.min.js"></script>

<!-- arkose labs -->
<script src="//api.arkoselabs.com/v2/726E9EF7-02A0-C8AD-9B35-5577632DDE75/api.js" data-callback="setupEnforcement" async defer></script>

<!-- css -->

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css">

<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">

<link
  href="https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.14.0/css/okta-sign-in.min.css"
  type="text/css"
  rel="stylesheet"/>

<link href="https://getbootstrap.com/docs/4.2/examples/starter-template/starter-template.css" rel="stylesheet" type="text/css">

<script>

var oktaURL = "https://okta-arkose.oktapreview.com"

var options = {
  baseUrl: oktaURL,
}

var signIn = new OktaSignIn(options)

signIn.session.get(function (res) {

  if (res.status === 'ACTIVE') {
    console.log("the user has a session")

    $("#login").hide()

    $("#welcome").show()

    $("#username").html(res.login)
  }
  else {
    console.log("the user does not have a session")

    $("#welcome").hide()
  }
})

function logout(){
  signIn.session.close(function (err) {
    if (err) {
      return;
    }

    location.reload(true)
  });
}
</script>

</head>

<body>

<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="/">Atko</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
      </li>
    </ul>
  </div>
</nav>

<main role="main" class="container">
  <div class="starter-template">
    <h1>Welcome to Atko corp!</h1>

    <div id = "welcome" style = "display: none">
      <p>It's great to have you here, <span id="username"></span>!</p>

      <button id="logout" onclick="logout()">log out</button>

    </div>

    <div id = "login">
      <p class="lead">Please log in to get started.</p>
      <button id="enforcement-trigger">log in</button>
    </div>

  </div>
</main>

<script>

function setupEnforcement(myEnforcement) {
  myEnforcement.setConfig({
    selector: '#enforcement-trigger',
    onCompleted: function(response) {
    	console.log("the response token is:")
      console.log(response.token);
      sessionStorage.setItem("arkoseToken", response.token);
      location.replace("okta.html");
    }
  });
}

</script>

</body>

</html>