<html>

<head>

<title>Okta + Arkose Labs</title>

<!-- javascript -->

<!-- jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- okta sign-in widget -->
<!-- <script src="https://s3.us-east-2.amazonaws.com/tom-smith-okta/okta-widget/okta-sign-in.min.js"></script>
 -->

<!-- okta sign-in sdk -->

<script src="https://ok1static.oktacdn.com/assets/js/sdk/okta-auth-js/2.0.1/okta-auth-js.min.js" type="text/javascript"></script>

<!-- arkose labs -->
<script src="//api.arkoselabs.com/v2/726E9EF7-02A0-C8AD-9B35-5577632DDE75/api.js" data-callback="setupEnforcement" async defer></script>

<!-- css -->

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css">

<link href="/css/sign-in-form.css" rel="stylesheet" type="text/css">


<!-- <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
 -->
<!-- <link
  href="https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.14.0/css/okta-sign-in.min.css"
  type="text/css"
  rel="stylesheet"/> -->

<link href="https://getbootstrap.com/docs/4.2/examples/starter-template/starter-template.css" rel="stylesheet" type="text/css">

<script>

// var oktaURL = "https://okta-arkose.oktapreview.com"

// var options = {
//   baseUrl: oktaURL,
// }

// var signIn = new OktaSignIn(options)

// signIn.session.get(function (res) {

//   if (res.status === 'ACTIVE') {
//     console.log("the user has a session")

//     $("#login").hide()

//     $("#welcome").show()

//     $("#username").html(res.login)
//   }
//   else {
//     console.log("the user does not have a session")

//     $("#welcome").hide()
//   }
// })

// function logout(){
//   signIn.session.close(function (err) {
//     if (err) {
//       return;
//     }

//     location.reload(true)
//   });
// }

function submit_creds() {

  var data = {
    username: $("#username").val()
  }

  alert("the username is: " + JSON.stringify(data))

  // var settings = {
  //   "async": true,
  //   "crossDomain": true,
  //   "url": "https://localhost:3378/api/v1/authn",
  //   "method": "POST",
  //   "headers": {
  //     "Accept": "application/json",
  //     "Content-Type": "application/json",
  //     "cache-control": "no-cache"
  //   },
  //   "processData": false,
  //   "data": "{\n  \"username\": \"\",\n  \"password\": \"Okta1234!\",\n  \"options\": {\n    \"multiOptionalFactorEnroll\": true,\n    \"warnBeforePasswordExpired\": true\n  }  \n}"
  // }

  // $.ajax(settings).done(function (response) {
  //   console.log(response);
  // });
}

</script>

</head>

<body>

<script>
  // Bootstrap the AuthJS Client
  var authClient = new OktaAuth({
    // Org URL
    url: 'https://okta-arkose.oktapreview.com',
    // OpenID Connect APP Client ID
    clientId: '0oajdyrcz6yCh60oG0h7',
    // Trusted Origin Redirect URI
    redirectUri: 'http://localhost:3378'
  });
  // Attempt to retrieve ID Token from Token Manager
  var idToken = authClient.tokenManager.get('idToken')
  .then(idToken => {
    // If ID Token exists, output it to the console
    if (idToken) {
      console.log(`hi ${idToken.claims.email}!`);
    // If ID Token isn't found, try to parse it from the current URL
    } else if (location.hash) {
      authClient.token.parseFromUrl()
      .then(idToken => {
        console.log(`hi ${idToken.claims.email}!`);
        // Store parsed token in Token Manager
        authClient.tokenManager.add('idToken', idToken);
        console.log(idToken);
      });
    } else {
      // You're not logged in, you need a sessionToken

      console.log("the user does not have an okta session.")
      // var username = prompt('What is your username?');
      // var password = prompt('What is your password?');

      // authClient.signIn({username, password})
      // .then(res => {
      //   if (res.status === 'SUCCESS') {
      //     authClient.token.getWithRedirect({
      //       sessionToken: res.sessionToken,
      //       responseType: 'id_token'
      //     });
      //   }
      // });
    }
  });
</script>



<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="/">Atko</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
      </li>
    </ul>
  </div>
</nav>

<main role="main" class="container">
  <div class="starter-template">
    <h1>Welcome to Atko corp!</h1>

    <div id = "welcome" style = "display: none">
      <p>It's great to have you here, <span id="username"></span>!</p>

      <button id="logout" onclick="logout()">log out</button>

    </div>

<!-- <!-- <!--     <div id = "login">
      <p class="lead">Please sign in to get started.</p>
<!--       <button id="enforcement-trigger">log in</button>
 -->    </div>

        <div class="row">
      <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
        <div class="card card-signin my-5">
          <div class="card-body">
            <h5 class="card-title text-center">Sign In</h5>
            <form class="form-signin" action="#">
              <div class="form-label-group">
<!--                 <input type="text" id="username" class="form-control" placeholder="username" autofocus>
 -->                <label for="username">username</label>
              </div>

              <div class="form-label-group">
<!--                 <input type="password" id="inputPassword" class="form-control" placeholder="password">
 -->                <label for="inputPassword">password</label>
              </div>

              <div class="custom-control custom-checkbox mb-3">
                <input type="checkbox" class="custom-control-input" id="customCheck1">
                <label class="custom-control-label" for="customCheck1">Remember password</label>
              </div>
<!--               <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit" id="enforcement-trigger">Sign in</button>
 -->        
<!--               <button class="btn btn-lg btn-primary btn-block text-uppercase" id="enforcement-trigger">Sign in</button>
 -->
<!--               <hr class="my-4">
              <button class="btn btn-lg btn-google btn-block text-uppercase" type="submit"><i class="fab fa-google mr-2"></i> Sign in with Google</button>
              <button class="btn btn-lg btn-facebook btn-block text-uppercase" type="submit"><i class="fab fa-facebook-f mr-2"></i> Sign in with Facebook</button> -->
            </form>

<!--             <button class="btn btn-lg btn-primary btn-block text-uppercase" id="enforcement-trigger">Sign in</button>
 -->          </div>
        </div>
      </div>
    </div> --> --> -->

    <div id = "login2">
      <p class="lead">Please sign in to get started.</p>
<!--       <button id="enforcement-trigger">log in</button>
 -->    </div>

        <div class="row">
      <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
        <div class="card card-signin my-5">
          <div class="card-body">
            <h5 class="card-title text-center">Sign In</h5>
            <form class="form-signin" action="/authn" method="POST">
              <div class="form-label-group">
                <input type="text" id="username" class="form-control" placeholder="username" autofocus>
                <label for="username">username</label>
              </div>

              <div class="form-label-group">
                <input type="password" id="inputPassword" class="form-control" placeholder="password">
                <label for="inputPassword">password</label>
              </div>

<!--               <div class="custom-control custom-checkbox mb-3">
                <input type="checkbox" class="custom-control-input" id="customCheck1">
                <label class="custom-control-label" for="customCheck1">Remember password</label>
              </div> -->
<!--               <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit" id="enforcement-trigger">Sign in</button>
 -->        
              <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit" id="enforcement-trigger">Sign in</button>

<!--               <hr class="my-4">
              <button class="btn btn-lg btn-google btn-block text-uppercase" type="submit"><i class="fab fa-google mr-2"></i> Sign in with Google</button>
              <button class="btn btn-lg btn-facebook btn-block text-uppercase" type="submit"><i class="fab fa-facebook-f mr-2"></i> Sign in with Facebook</button> -->
            </form>

<!--             <button class="btn btn-lg btn-primary btn-block text-uppercase" id="enforcement-trigger">Sign in</button>
 -->          </div>
        </div>
      </div>
    </div>



  </div>
</main>

<script>

function setupEnforcement(myEnforcement) {
  myEnforcement.setConfig({
    selector: '#enforcement-trigger',
    onCompleted: function(response) {
    	console.log("the response token is:")
      console.log(response.token);
      sessionStorage.setItem("arkoseToken", response.token);
      submit_creds();
      // location.replace("okta.html");
    }
  });
}

</script>

</body>

</html>